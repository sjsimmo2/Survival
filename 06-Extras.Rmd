# Extras



```{r packages,include=F}
library(survival)
library(foreign)
library(ggplot2)
library(survminer)
library(rms)
library(flexsurv)
library(dplyr)
library(ciTools)
library(here)
library(visreg)
library(cmprsk)
loyalty=read.csv("Q:\\My Drive\\Fall 3 2016 Survival Analysis\\Data\\Data_R\\loyalty.csv",header=T)
recid=read.csv("Q:\\My Drive\\Fall 3 2016 Survival Analysis\\Data\\Data_R\\recid.csv",header=T)


```


## Using Lasso

```{r}
library(glmnet)
x=recid %>% select(fin,age,wexp,mar,paro,prio,educ)
y=Surv(time=recid$week,event=recid$arrest)
model1<-glmnet(x,y,family="cox")
plot(model1)

x<-as.matrix(x)
set.seed(1287)
cvfit <- cv.glmnet(x, y, family = "cox", type.measure = "C")
plot(cvfit)


plot(cvfit)
cvfit$lambda.min
cvfit$lambda.1se

coef(model1,s=0.0034)
coef(model1,s=0.04)
### Uses Breslow for ties (not able to do Efron...yet)
```
Can also do repeated events and stratified analysis, see https://glmnet.stanford.edu/articles/Coxnet.html.


## Decision Trees
```{r}
library(rpart)
library(partykit)
data("GBSG2", package = "TH.data")


tree.surv<- ctree(Surv(time,cens) ~ . ,data=GBSG2)
tree.surv
plot(tree.surv)
predict(tree.surv, newdata = GBSG2[1:2,], type = "node")
predict(tree.surv, newdata = GBSG2[1:2,], type = "response")


```
This is using conditional trees in the partykit package in R.

## Random Forest

```{r}
library(randomForestSRC)
library(ggRandomForests)

surv.rf <- rfsrc(Surv(time,cens) ~ . ,data=GBSG2,importance = TRUE)
plot.survival(surv.rf, subset = 1:10)
print(surv.rf$importance)
```

For more information, see https://www.randomforestsrc.org/articles/survival.html,  https://www.randomforestsrc.org/index.html for the Survival Random Forest or https://cran.microsoft.com/snapshot/2014-12-19/web/packages/ggRandomForests/vignettes/randomForestSurvival.pdf for nice visuals using the ggRandomForest package.