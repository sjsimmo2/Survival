<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Accelerated Failure Time models | Survival Analysis</title>
  <meta name="description" content="Chapter 3 Accelerated Failure Time models | Survival Analysis" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Accelerated Failure Time models | Survival Analysis" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Accelerated Failure Time models | Survival Analysis" />
  
  
  

<meta name="author" content="Susan Simmons" />


<meta name="date" content="2024-10-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-survival.html"/>
<link rel="next" href="cox-survival-regression.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SurvivalAnalysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Survival Analysis Book</a></li>
<li class="chapter" data-level="2" data-path="introduction-to-survival.html"><a href="introduction-to-survival.html"><i class="fa fa-check"></i><b>2</b> Introduction to Survival</a>
<ul>
<li class="chapter" data-level="2.0.1" data-path="introduction-to-survival.html"><a href="introduction-to-survival.html#python-for-survival-curves"><i class="fa fa-check"></i><b>2.0.1</b> Python for Survival Curves</a></li>
<li class="chapter" data-level="2.1" data-path="introduction-to-survival.html"><a href="introduction-to-survival.html#stratified-analysis"><i class="fa fa-check"></i><b>2.1</b> Stratified Analysis</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="introduction-to-survival.html"><a href="introduction-to-survival.html#python-for-stratified-analysis"><i class="fa fa-check"></i><b>2.1.1</b> Python for stratified analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-survival.html"><a href="introduction-to-survival.html#hazard-function"><i class="fa fa-check"></i><b>2.2</b> Hazard function</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction-to-survival.html"><a href="introduction-to-survival.html#python-for-hazard-function"><i class="fa fa-check"></i><b>2.2.1</b> Python for Hazard function</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="accelerated-failure-time-models.html"><a href="accelerated-failure-time-models.html"><i class="fa fa-check"></i><b>3</b> Accelerated Failure Time models</a>
<ul>
<li class="chapter" data-level="3.1" data-path="accelerated-failure-time-models.html"><a href="accelerated-failure-time-models.html#predict-mean-survival"><i class="fa fa-check"></i><b>3.1</b> Predict mean survival</a></li>
<li class="chapter" data-level="3.2" data-path="accelerated-failure-time-models.html"><a href="accelerated-failure-time-models.html#predict-quantiles"><i class="fa fa-check"></i><b>3.2</b> Predict quantiles</a></li>
<li class="chapter" data-level="3.3" data-path="accelerated-failure-time-models.html"><a href="accelerated-failure-time-models.html#percentiles-for-an-individual-person"><i class="fa fa-check"></i><b>3.3</b> Percentiles for an individual person</a></li>
<li class="chapter" data-level="3.4" data-path="accelerated-failure-time-models.html"><a href="accelerated-failure-time-models.html#finding-probabilities-of-a-given-value"><i class="fa fa-check"></i><b>3.4</b> Finding probabilities of a given value</a></li>
<li class="chapter" data-level="3.5" data-path="accelerated-failure-time-models.html"><a href="accelerated-failure-time-models.html#python-code"><i class="fa fa-check"></i><b>3.5</b> Python Code</a></li>
<li class="chapter" data-level="3.6" data-path="accelerated-failure-time-models.html"><a href="accelerated-failure-time-models.html#interesting-application"><i class="fa fa-check"></i><b>3.6</b> Interesting application</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cox-survival-regression.html"><a href="cox-survival-regression.html"><i class="fa fa-check"></i><b>4</b> Cox Survival Regression</a>
<ul>
<li class="chapter" data-level="4.0.1" data-path="cox-survival-regression.html"><a href="cox-survival-regression.html#python-code-for-cox-regression"><i class="fa fa-check"></i><b>4.0.1</b> Python code for Cox regression</a></li>
<li class="chapter" data-level="4.1" data-path="cox-survival-regression.html"><a href="cox-survival-regression.html#diagnostics"><i class="fa fa-check"></i><b>4.1</b> Diagnostics</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="cox-survival-regression.html"><a href="cox-survival-regression.html#python-for-diagnostics"><i class="fa fa-check"></i><b>4.1.1</b> Python for Diagnostics</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="competing-risks.html"><a href="competing-risks.html"><i class="fa fa-check"></i><b>5</b> Competing Risks</a>
<ul>
<li class="chapter" data-level="5.1" data-path="competing-risks.html"><a href="competing-risks.html#python-code-for-competing-risks-models"><i class="fa fa-check"></i><b>5.1</b> Python code for competing risks models</a></li>
<li class="chapter" data-level="5.2" data-path="competing-risks.html"><a href="competing-risks.html#python-code-for-repeated-events"><i class="fa fa-check"></i><b>5.2</b> Python Code for repeated events</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="extras.html"><a href="extras.html"><i class="fa fa-check"></i><b>6</b> Extras</a>
<ul>
<li class="chapter" data-level="6.1" data-path="extras.html"><a href="extras.html#using-lasso"><i class="fa fa-check"></i><b>6.1</b> Using Lasso</a></li>
<li class="chapter" data-level="6.2" data-path="extras.html"><a href="extras.html#decision-trees"><i class="fa fa-check"></i><b>6.2</b> Decision Trees</a></li>
<li class="chapter" data-level="6.3" data-path="extras.html"><a href="extras.html#random-forest"><i class="fa fa-check"></i><b>6.3</b> Random Forest</a></li>
<li class="chapter" data-level="6.4" data-path="extras.html"><a href="extras.html#python"><i class="fa fa-check"></i><b>6.4</b> Python</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Survival Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="accelerated-failure-time-models" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Accelerated Failure Time models<a href="accelerated-failure-time-models.html#accelerated-failure-time-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The following R codes illustrate how to fit the Accelerated Failure Time models.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="accelerated-failure-time-models.html#cb1-1" tabindex="-1"></a><span class="co"># Accelerated Failure Time Model </span></span>
<span id="cb1-2"><a href="accelerated-failure-time-models.html#cb1-2" tabindex="-1"></a>recid.aft.ln <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> mar <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&#39;lognormal&#39;</span>)</span>
<span id="cb1-3"><a href="accelerated-failure-time-models.html#cb1-3" tabindex="-1"></a><span class="fu">summary</span>(recid.aft.ln)</span></code></pre></div>
<pre><code>## 
## Call:
## survreg(formula = Surv(week, arrest) ~ fin + age + mar + prio, 
##     data = recid, dist = &quot;lognormal&quot;)
##               Value Std. Error     z       p
## (Intercept)  4.0146     0.3897 10.30 &lt; 2e-16
## fin          0.3319     0.1657  2.00 0.04524
## age          0.0333     0.0153  2.18 0.02959
## mar          0.5609     0.2928  1.92 0.05541
## prio        -0.0743     0.0264 -2.82 0.00481
## Log(scale)   0.2723     0.0765  3.56 0.00037
## 
## Scale= 1.31 
## 
## Log Normal distribution
## Loglik(model)= -685.5   Loglik(intercept only)= -697.9
##  Chisq= 24.85 on 4 degrees of freedom, p= 5.4e-05 
## Number of Newton-Raphson Iterations: 4 
## n= 432</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="accelerated-failure-time-models.html#cb3-1" tabindex="-1"></a><span class="co">#Parameter interpretation</span></span>
<span id="cb3-2"><a href="accelerated-failure-time-models.html#cb3-2" tabindex="-1"></a>(<span class="fu">exp</span>(<span class="fu">coef</span>(recid.aft.ln))<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span></span></code></pre></div>
<pre><code>## (Intercept)         fin         age         mar        prio 
## 5439.988576   39.357426    3.386427   75.223685   -7.163067</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="accelerated-failure-time-models.html#cb5-1" tabindex="-1"></a><span class="co"># Exponential vs. Weibull </span></span>
<span id="cb5-2"><a href="accelerated-failure-time-models.html#cb5-2" tabindex="-1"></a>recid.aft.w <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age  <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&#39;weibull&#39;</span>)</span>
<span id="cb5-3"><a href="accelerated-failure-time-models.html#cb5-3" tabindex="-1"></a><span class="fu">summary</span>(recid.aft.w)</span></code></pre></div>
<pre><code>## 
## Call:
## survreg(formula = Surv(week, arrest) ~ fin + age + wexp + mar + 
##     paro + prio, data = recid, dist = &quot;weibull&quot;)
##               Value Std. Error     z       p
## (Intercept)  3.8086     0.3762 10.12 &lt; 2e-16
## fin          0.2625     0.1376  1.91 0.05650
## age          0.0400     0.0159  2.51 0.01210
## wexp         0.1115     0.1516  0.74 0.46196
## mar          0.3389     0.2725  1.24 0.21366
## paro         0.0538     0.1394  0.39 0.69956
## prio        -0.0646     0.0210 -3.08 0.00208
## Log(scale)  -0.3383     0.0891 -3.80 0.00015
## 
## Scale= 0.713 
## 
## Weibull distribution
## Loglik(model)= -680.5   Loglik(intercept only)= -696.6
##  Chisq= 32.28 on 6 degrees of freedom, p= 1.4e-05 
## Number of Newton-Raphson Iterations: 6 
## n= 432</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="accelerated-failure-time-models.html#cb7-1" tabindex="-1"></a><span class="co"># Checking Distributions </span></span>
<span id="cb7-2"><a href="accelerated-failure-time-models.html#cb7-2" tabindex="-1"></a>recid.aft.w <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;weibull&quot;</span>)</span>
<span id="cb7-3"><a href="accelerated-failure-time-models.html#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="accelerated-failure-time-models.html#cb7-4" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb7-5"><a href="accelerated-failure-time-models.html#cb7-5" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Weibull Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-1.png" width="672" /></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="accelerated-failure-time-models.html#cb8-1" tabindex="-1"></a>recid.aft.e <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb8-2"><a href="accelerated-failure-time-models.html#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="accelerated-failure-time-models.html#cb8-3" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.e, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb8-4"><a href="accelerated-failure-time-models.html#cb8-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Exponential Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-2.png" width="672" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="accelerated-failure-time-models.html#cb9-1" tabindex="-1"></a>recid.aft.g <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;gamma&quot;</span>)</span>
<span id="cb9-2"><a href="accelerated-failure-time-models.html#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="accelerated-failure-time-models.html#cb9-3" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.g, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb9-4"><a href="accelerated-failure-time-models.html#cb9-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Gamma Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-3.png" width="672" /></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="accelerated-failure-time-models.html#cb10-1" tabindex="-1"></a>recid.aft.ll <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;llogis&quot;</span>)</span>
<span id="cb10-2"><a href="accelerated-failure-time-models.html#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="accelerated-failure-time-models.html#cb10-3" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.ll, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb10-4"><a href="accelerated-failure-time-models.html#cb10-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Log-Logistic Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-4.png" width="672" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="accelerated-failure-time-models.html#cb11-1" tabindex="-1"></a>recid.aft.ln <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;lognormal&quot;</span>)</span>
<span id="cb11-2"><a href="accelerated-failure-time-models.html#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="accelerated-failure-time-models.html#cb11-3" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.ln, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb11-4"><a href="accelerated-failure-time-models.html#cb11-4" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Log-Normal Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-5.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="accelerated-failure-time-models.html#cb12-1" tabindex="-1"></a><span class="co"># Goodness-of-Fit Tests </span></span>
<span id="cb12-2"><a href="accelerated-failure-time-models.html#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="accelerated-failure-time-models.html#cb12-3" tabindex="-1"></a>like.e <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>  wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;exp&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb12-4"><a href="accelerated-failure-time-models.html#cb12-4" tabindex="-1"></a>like.w <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>  wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;weibull&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb12-5"><a href="accelerated-failure-time-models.html#cb12-5" tabindex="-1"></a>like.ln <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>  wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;lnorm&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb12-6"><a href="accelerated-failure-time-models.html#cb12-6" tabindex="-1"></a>like.g <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age  <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;gamma&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb12-7"><a href="accelerated-failure-time-models.html#cb12-7" tabindex="-1"></a>like.ll <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age  <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;llogis&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb12-8"><a href="accelerated-failure-time-models.html#cb12-8" tabindex="-1"></a>like.f <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age  <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;genf&quot;</span>)<span class="sc">$</span>loglik</span></code></pre></div>
<pre><code>## Warning in .hess_to_cov(opt$hessian, hess.control$tol.solve,
## hess.control$tol.evalues): Hessian not positive definite: smallest eigenvalue
## is -4.2e+02 (threshold: -1.0e-05). This might indicate that the optimization
## did not converge to the maximum likelihood, so that the results are invalid.
## Continuing with the nearest positive definite approximation of the covariance
## matrix.</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="accelerated-failure-time-models.html#cb14-1" tabindex="-1"></a>pval.e.g <span class="ot">=</span> <span class="fu">pchisq</span>((<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(like.e<span class="sc">-</span>like.g)), <span class="dv">2</span>,<span class="at">lower.tail=</span>F)</span>
<span id="cb14-2"><a href="accelerated-failure-time-models.html#cb14-2" tabindex="-1"></a>pval.w.g <span class="ot">=</span> <span class="fu">pchisq</span>((<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(like.w<span class="sc">-</span>like.g)), <span class="dv">1</span>,<span class="at">lower.tail=</span>F)</span>
<span id="cb14-3"><a href="accelerated-failure-time-models.html#cb14-3" tabindex="-1"></a>pval.ln.g <span class="ot">=</span> <span class="fu">pchisq</span>((<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(like.ln<span class="sc">-</span>like.g)), <span class="dv">1</span>,<span class="at">lower.tail=</span>F)</span>
<span id="cb14-4"><a href="accelerated-failure-time-models.html#cb14-4" tabindex="-1"></a><span class="do">##pval.g.f = pchisq((-2*(like.g-like.f)), 1,lower.tail=F)</span></span>
<span id="cb14-5"><a href="accelerated-failure-time-models.html#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="accelerated-failure-time-models.html#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="accelerated-failure-time-models.html#cb14-7" tabindex="-1"></a>Tests <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;Exp vs. Gam&#39;</span>, <span class="st">&#39;Wei vs. Gam&#39;</span>, <span class="st">&#39;LogN vs. Gam&#39;</span>)</span>
<span id="cb14-8"><a href="accelerated-failure-time-models.html#cb14-8" tabindex="-1"></a>P_values <span class="ot">=</span> <span class="fu">c</span>(pval.e.g, pval.w.g, pval.ln.g)</span>
<span id="cb14-9"><a href="accelerated-failure-time-models.html#cb14-9" tabindex="-1"></a><span class="fu">cbind</span>(Tests, P_values)</span></code></pre></div>
<pre><code>##      Tests          P_values             
## [1,] &quot;Exp vs. Gam&quot;  &quot;0.00194259347065306&quot;
## [2,] &quot;Wei vs. Gam&quot;  &quot;1&quot;                  
## [3,] &quot;LogN vs. Gam&quot; &quot;0.00767095999547838&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="accelerated-failure-time-models.html#cb16-1" tabindex="-1"></a><span class="co"># Predicted Survival Quantiles </span></span>
<span id="cb16-2"><a href="accelerated-failure-time-models.html#cb16-2" tabindex="-1"></a>recid.aft.w <span class="ot">=</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&#39;weibull&#39;</span>)</span>
<span id="cb16-3"><a href="accelerated-failure-time-models.html#cb16-3" tabindex="-1"></a><span class="fu">summary</span>(recid.aft.w)</span></code></pre></div>
<pre><code>## 
## Call:
## survreg(formula = Surv(week, arrest) ~ fin + age + prio, data = recid, 
##     dist = &quot;weibull&quot;)
##               Value Std. Error     z       p
## (Intercept)  3.7738     0.3581 10.54 &lt; 2e-16
## fin          0.2495     0.1372  1.82 0.06901
## age          0.0478     0.0154  3.11 0.00189
## prio        -0.0698     0.0201 -3.47 0.00051
## Log(scale)  -0.3367     0.0892 -3.77 0.00016
## 
## Scale= 0.714 
## 
## Weibull distribution
## Loglik(model)= -682   Loglik(intercept only)= -696.6
##  Chisq= 29.17 on 3 degrees of freedom, p= 2.1e-06 
## Number of Newton-Raphson Iterations: 6 
## n= 432</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="accelerated-failure-time-models.html#cb18-1" tabindex="-1"></a>survprob.<span class="dv">75</span>.<span class="fl">50.25</span> <span class="ot">=</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>,<span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb18-2"><a href="accelerated-failure-time-models.html#cb18-2" tabindex="-1"></a><span class="fu">head</span>(survprob.<span class="dv">75</span>.<span class="fl">50.25</span><span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>##          [,1]      [,2]      [,3]
## [1,] 52.68849  98.72758 161.95827
## [2,] 24.17956  45.30760  74.32514
## [3,] 17.89085  33.52383  54.99438
## [4,] 64.22717 120.34873 197.42682
## [5,] 35.95471  67.37185 110.52057
## [6,] 48.95457  91.73097 150.48064</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="accelerated-failure-time-models.html#cb20-1" tabindex="-1"></a><span class="co"># Predicted Mean Event Time #</span></span>
<span id="cb20-2"><a href="accelerated-failure-time-models.html#cb20-2" tabindex="-1"></a>p.time.mean <span class="ot">=</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-3"><a href="accelerated-failure-time-models.html#cb20-3" tabindex="-1"></a><span class="fu">head</span>(p.time.mean<span class="sc">$</span>fit, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 128.26394  58.86229  43.55317 156.35349  87.52751 119.17415 143.73152
##  [8] 115.26040  81.92984 113.19494</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="accelerated-failure-time-models.html#cb22-1" tabindex="-1"></a><span class="co"># Predicted Survival Probabilities #</span></span>
<span id="cb22-2"><a href="accelerated-failure-time-models.html#cb22-2" tabindex="-1"></a>survprob.actual <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">psurvreg</span>(recid<span class="sc">$</span>week,</span>
<span id="cb22-3"><a href="accelerated-failure-time-models.html#cb22-3" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>),</span>
<span id="cb22-4"><a href="accelerated-failure-time-models.html#cb22-4" tabindex="-1"></a>      <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale, <span class="at">distribution =</span>     recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb22-5"><a href="accelerated-failure-time-models.html#cb22-5" tabindex="-1"></a><span class="fu">head</span>(survprob.actual, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.9285822 0.8389085 0.6315234 0.8073231 0.6173609 0.7312118 0.9260438
##  [8] 0.7203354 0.5891529 0.7143008</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="accelerated-failure-time-models.html#cb24-1" tabindex="-1"></a>survprob<span class="fl">.10</span>wk <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">psurvreg</span>(<span class="dv">10</span>,</span>
<span id="cb24-2"><a href="accelerated-failure-time-models.html#cb24-2" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>),</span>
<span id="cb24-3"><a href="accelerated-failure-time-models.html#cb24-3" tabindex="-1"></a>    <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale,</span>
<span id="cb24-4"><a href="accelerated-failure-time-models.html#cb24-4" tabindex="-1"></a>    <span class="at">distribution =</span> recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb24-5"><a href="accelerated-failure-time-models.html#cb24-5" tabindex="-1"></a><span class="fu">head</span>(survprob<span class="fl">.10</span>wk)</span></code></pre></div>
<pre><code>## [1] 0.9723202 0.9198457 0.8803901 0.9789527 0.9531961 0.9693657</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="accelerated-failure-time-models.html#cb26-1" tabindex="-1"></a><span class="co"># Predicted Change in Event Time #</span></span>
<span id="cb26-2"><a href="accelerated-failure-time-models.html#cb26-2" tabindex="-1"></a>new_time <span class="ot">=</span> <span class="fu">qsurvreg</span>(<span class="dv">1</span> <span class="sc">-</span> survprob.actual,</span>
<span id="cb26-3"><a href="accelerated-failure-time-models.html#cb26-3" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="accelerated-failure-time-models.html#cb26-4" tabindex="-1"></a>  <span class="fu">coef</span>(recid.aft.w)[<span class="st">&#39;fin&#39;</span>],</span>
<span id="cb26-5"><a href="accelerated-failure-time-models.html#cb26-5" tabindex="-1"></a>  <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale,</span>
<span id="cb26-6"><a href="accelerated-failure-time-models.html#cb26-6" tabindex="-1"></a>  <span class="at">distribution =</span> recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb26-7"><a href="accelerated-failure-time-models.html#cb26-7" tabindex="-1"></a></span>
<span id="cb26-8"><a href="accelerated-failure-time-models.html#cb26-8" tabindex="-1"></a>recid<span class="sc">$</span>new_time <span class="ot">=</span> new_time</span>
<span id="cb26-9"><a href="accelerated-failure-time-models.html#cb26-9" tabindex="-1"></a>recid<span class="sc">$</span>diff <span class="ot">=</span> recid<span class="sc">$</span>new_time <span class="sc">-</span> recid<span class="sc">$</span>week</span>
<span id="cb26-10"><a href="accelerated-failure-time-models.html#cb26-10" tabindex="-1"></a></span>
<span id="cb26-11"><a href="accelerated-failure-time-models.html#cb26-11" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(recid<span class="sc">$</span>week, recid<span class="sc">$</span>new_time, recid<span class="sc">$</span>diff), <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    recid.week recid.new_time recid.diff
## 1          20       25.66776   5.667764
## 2          17       21.81760   4.817600
## 3          25       32.08471   7.084706
## 4          52       66.73619  14.736188
## 5          52       66.73619  14.736188
## 6          52       66.73619  14.736188
## 7          23       29.51793   6.517929
## 8          52       66.73619  14.736188
## 9          52       66.73619  14.736188
## 10         52       66.73619  14.736188</code></pre>
<p>Let’s break down this code into smaller chunks to understand what is going on in each one…</p>
<div id="predict-mean-survival" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Predict mean survival<a href="accelerated-failure-time-models.html#predict-mean-survival" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the survival regression, when we use the predict command (with nothing else), this is predicting the mean survival time. This means, on average when do we think the event will occur? For example, we will continue to use the recidivism data set with the Weibull distribution with the variables fin, age and prior. The following command will predict the mean time of the event occurring (only printing off a few to see).</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="accelerated-failure-time-models.html#cb28-1" tabindex="-1"></a>recid.aft.w <span class="ot">=</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&#39;weibull&#39;</span>)</span>
<span id="cb28-2"><a href="accelerated-failure-time-models.html#cb28-2" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(recid.aft.w))</span></code></pre></div>
<pre><code>## [1] 128.26394  58.86229  43.55317 156.35349  87.52751 119.17415</code></pre>
</div>
<div id="predict-quantiles" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Predict quantiles<a href="accelerated-failure-time-models.html#predict-quantiles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>But does it make sense to predict on average when we think an event will occur (or when an event will fail)? Probably not. Another approach would be to print the quantiles (for example the 25th, 50th and 75th quantile).</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="accelerated-failure-time-models.html#cb30-1" tabindex="-1"></a>survprob.<span class="dv">75</span>.<span class="fl">50.25</span> <span class="ot">=</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>,<span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb30-2"><a href="accelerated-failure-time-models.html#cb30-2" tabindex="-1"></a><span class="fu">head</span>(survprob.<span class="dv">75</span>.<span class="fl">50.25</span><span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>##          [,1]      [,2]      [,3]
## [1,] 52.68849  98.72758 161.95827
## [2,] 24.17956  45.30760  74.32514
## [3,] 17.89085  33.52383  54.99438
## [4,] 64.22717 120.34873 197.42682
## [5,] 35.95471  67.37185 110.52057
## [6,] 48.95457  91.73097 150.48064</code></pre>
</div>
<div id="percentiles-for-an-individual-person" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Percentiles for an individual person<a href="accelerated-failure-time-models.html#percentiles-for-an-individual-person" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Did you know that from this regression, each observation has their own survival curve? That is why we can get quantiles (we can go the “opposite” direction and get percentiles too!). Below you will find the survival curve for person 1…</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="accelerated-failure-time-models.html#cb32-1" tabindex="-1"></a>quant.prob<span class="ot">=</span><span class="fu">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="at">by=</span><span class="fl">0.05</span>)</span>
<span id="cb32-2"><a href="accelerated-failure-time-models.html#cb32-2" tabindex="-1"></a>survprob <span class="ot">=</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>,<span class="at">p =</span> quant.prob)</span>
<span id="cb32-3"><a href="accelerated-failure-time-models.html#cb32-3" tabindex="-1"></a>surv.prob<span class="ot">=</span><span class="fu">rev</span>(quant.prob)</span>
<span id="cb32-4"><a href="accelerated-failure-time-models.html#cb32-4" tabindex="-1"></a>graph.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(survprob<span class="sc">$</span>fit[<span class="dv">1</span>,],surv.prob))</span>
<span id="cb32-5"><a href="accelerated-failure-time-models.html#cb32-5" tabindex="-1"></a><span class="fu">colnames</span>(graph.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Tenure&quot;</span>,<span class="st">&quot;SurvivalProb&quot;</span>)</span>
<span id="cb32-6"><a href="accelerated-failure-time-models.html#cb32-6" tabindex="-1"></a><span class="fu">ggplot</span>(graph.dat,<span class="fu">aes</span>(<span class="at">x=</span>Tenure,<span class="at">y=</span>SurvivalProb))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Survival Curve for Person 1&quot;</span>,<span class="at">x=</span><span class="st">&quot;Tenure&quot;</span>,<span class="at">y=</span><span class="st">&quot;Survival Probability&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Survival%20curve%20for%20person%201-1.png" width="672" /></p>
</div>
<div id="finding-probabilities-of-a-given-value" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Finding probabilities of a given value<a href="accelerated-failure-time-models.html#finding-probabilities-of-a-given-value" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We just predicted quantiles. We can go the opposite direction and find probabilities. To do this, the survreg function allows us to simply do psurvreg (we could have actually used qsurvreg for the previous piece in getting quantiles!!). Keep in mind that psurvreg is for the FAILURE probability (to get survival probabilities, we need to take 1-p, where p is the failure probability).</p>
<p>The below code finds the survival probability for each observed time! For example, person 1 was arrested on week 20 (where did that fall on their predicted survival curve?). Person 2 was arrested in week 17 (where did that fall on its predicted survival curve?).</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="accelerated-failure-time-models.html#cb33-1" tabindex="-1"></a>survprob.actual <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">psurvreg</span>(recid<span class="sc">$</span>week,</span>
<span id="cb33-2"><a href="accelerated-failure-time-models.html#cb33-2" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>),</span>
<span id="cb33-3"><a href="accelerated-failure-time-models.html#cb33-3" tabindex="-1"></a>      <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale, <span class="at">distribution =</span>     recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb33-4"><a href="accelerated-failure-time-models.html#cb33-4" tabindex="-1"></a><span class="fu">head</span>(survprob.actual, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.9285822 0.8389085 0.6315234 0.8073231 0.6173609 0.7312118 0.9260438
##  [8] 0.7203354 0.5891529 0.7143008</code></pre>
<p>We can also do this for a given point in time (say 10 weeks)….</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="accelerated-failure-time-models.html#cb35-1" tabindex="-1"></a>survprob<span class="fl">.10</span>wk <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">psurvreg</span>(<span class="dv">10</span>,</span>
<span id="cb35-2"><a href="accelerated-failure-time-models.html#cb35-2" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>),</span>
<span id="cb35-3"><a href="accelerated-failure-time-models.html#cb35-3" tabindex="-1"></a>    <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale,</span>
<span id="cb35-4"><a href="accelerated-failure-time-models.html#cb35-4" tabindex="-1"></a>    <span class="at">distribution =</span> recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb35-5"><a href="accelerated-failure-time-models.html#cb35-5" tabindex="-1"></a><span class="fu">head</span>(survprob<span class="fl">.10</span>wk)</span></code></pre></div>
<pre><code>## [1] 0.9723202 0.9198457 0.8803901 0.9789527 0.9531961 0.9693657</code></pre>
</div>
<div id="python-code" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Python Code<a href="accelerated-failure-time-models.html#python-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Python Code to create and fit models:</p>
<p>Weibull model:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="accelerated-failure-time-models.html#cb37-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb37-2"><a href="accelerated-failure-time-models.html#cb37-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb37-3"><a href="accelerated-failure-time-models.html#cb37-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb37-4"><a href="accelerated-failure-time-models.html#cb37-4" tabindex="-1"></a><span class="im">from</span> lifelines <span class="im">import</span> WeibullAFTFitter</span>
<span id="cb37-5"><a href="accelerated-failure-time-models.html#cb37-5" tabindex="-1"></a></span>
<span id="cb37-6"><a href="accelerated-failure-time-models.html#cb37-6" tabindex="-1"></a>recid <span class="op">=</span> r.recid</span>
<span id="cb37-7"><a href="accelerated-failure-time-models.html#cb37-7" tabindex="-1"></a></span>
<span id="cb37-8"><a href="accelerated-failure-time-models.html#cb37-8" tabindex="-1"></a>recid1<span class="op">=</span>recid[[<span class="st">&#39;fin&#39;</span>,<span class="st">&#39;age&#39;</span>,<span class="st">&#39;wexp&#39;</span>,<span class="st">&#39;mar&#39;</span>,<span class="st">&#39;paro&#39;</span>,<span class="st">&#39;prio&#39;</span>,<span class="st">&#39;week&#39;</span>,<span class="st">&#39;arrest&#39;</span>]]</span>
<span id="cb37-9"><a href="accelerated-failure-time-models.html#cb37-9" tabindex="-1"></a>aft <span class="op">=</span> WeibullAFTFitter()</span>
<span id="cb37-10"><a href="accelerated-failure-time-models.html#cb37-10" tabindex="-1"></a>aft.fit(recid1, duration_col<span class="op">=</span><span class="st">&#39;week&#39;</span>, event_col<span class="op">=</span><span class="st">&#39;arrest&#39;</span>,ancillary<span class="op">=</span><span class="va">False</span> )</span></code></pre></div>
<pre><code>## &lt;lifelines.WeibullAFTFitter: fitted with 432 total observations, 318 right-censored observations&gt;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="accelerated-failure-time-models.html#cb39-1" tabindex="-1"></a>aft.print_summary(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## &lt;lifelines.WeibullAFTFitter: fitted with 432 total observations, 318 right-censored observations&gt;
##              duration col = &#39;week&#39;
##                 event col = &#39;arrest&#39;
##    number of observations = 432
## number of events observed = 114
##            log-likelihood = -680.485
##          time fit was run = 2024-10-23 13:39:52 UTC
## 
## ---
##                     coef exp(coef)  se(coef)  coef lower 95%  coef upper 95% exp(coef) lower 95% exp(coef) upper 95%
## param   covariate                                                                                                   
## lambda_ age        0.040     1.041     0.016           0.009           0.071               1.009               1.074
##         fin        0.262     1.300     0.138          -0.007           0.532               0.993               1.703
##         mar        0.339     1.403     0.273          -0.195           0.873               0.823               2.394
##         paro       0.054     1.055     0.139          -0.219           0.327               0.803               1.387
##         prio      -0.065     0.937     0.021          -0.106          -0.023               0.900               0.977
##         wexp       0.112     1.118     0.152          -0.186           0.409               0.831               1.505
##         Intercept  3.809    45.086     0.376           3.071           4.546              21.569              94.241
## rho_    Intercept  0.338     1.403     0.089           0.164           0.513               1.178               1.670
## 
##                    cmp to      z       p  -log2(p)
## param   covariate                                 
## lambda_ age         0.000  2.509   0.012     6.368
##         fin         0.000  1.907   0.056     4.146
##         mar         0.000  1.244   0.214     2.227
##         paro        0.000  0.386   0.700     0.515
##         prio        0.000 -3.078   0.002     8.907
##         wexp        0.000  0.736   0.462     1.114
##         Intercept   0.000 10.124 &lt;0.0005    77.620
## rho_    Intercept   0.000  3.797 &lt;0.0005    12.736
## ---
## Concordance = 0.639
## AIC = 1376.971
## log-likelihood ratio test = 32.278 on 6 df
## -log2(p) of ll-ratio test = 16.080</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="accelerated-failure-time-models.html#cb41-1" tabindex="-1"></a></span>
<span id="cb41-2"><a href="accelerated-failure-time-models.html#cb41-2" tabindex="-1"></a><span class="co">## Note that Rho is the shape parameter.</span></span>
<span id="cb41-3"><a href="accelerated-failure-time-models.html#cb41-3" tabindex="-1"></a></span>
<span id="cb41-4"><a href="accelerated-failure-time-models.html#cb41-4" tabindex="-1"></a></span>
<span id="cb41-5"><a href="accelerated-failure-time-models.html#cb41-5" tabindex="-1"></a>aft.plot()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Log Logistic model:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="accelerated-failure-time-models.html#cb42-1" tabindex="-1"></a><span class="im">from</span> lifelines <span class="im">import</span> LogLogisticAFTFitter</span>
<span id="cb42-2"><a href="accelerated-failure-time-models.html#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="accelerated-failure-time-models.html#cb42-3" tabindex="-1"></a>aft <span class="op">=</span> LogLogisticAFTFitter()</span>
<span id="cb42-4"><a href="accelerated-failure-time-models.html#cb42-4" tabindex="-1"></a>aft.fit(recid1, duration_col<span class="op">=</span><span class="st">&#39;week&#39;</span>, event_col<span class="op">=</span><span class="st">&#39;arrest&#39;</span> )</span></code></pre></div>
<pre><code>## &lt;lifelines.LogLogisticAFTFitter: fitted with 432 total observations, 318 right-censored observations&gt;</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="accelerated-failure-time-models.html#cb44-1" tabindex="-1"></a>aft.print_summary(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## &lt;lifelines.LogLogisticAFTFitter: fitted with 432 total observations, 318 right-censored observations&gt;
##              duration col = &#39;week&#39;
##                 event col = &#39;arrest&#39;
##    number of observations = 432
## number of events observed = 114
##            log-likelihood = -680.725
##          time fit was run = 2024-10-23 13:39:54 UTC
## 
## ---
##                    coef exp(coef)  se(coef)  coef lower 95%  coef upper 95% exp(coef) lower 95% exp(coef) upper 95%
## param  covariate                                                                                                   
## alpha_ age        0.036     1.036     0.016           0.005           0.066               1.005               1.068
##        fin        0.277     1.319     0.145          -0.008           0.562               0.992               1.754
##        mar        0.373     1.453     0.271          -0.158           0.905               0.854               2.472
##        paro       0.037     1.038     0.149          -0.255           0.330               0.775               1.391
##        prio      -0.066     0.936     0.023          -0.111          -0.022               0.895               0.978
##        wexp       0.191     1.210     0.157          -0.118           0.500               0.889               1.648
##        Intercept  3.691    40.069     0.383           2.939           4.442              18.906              84.920
## beta_  Intercept  0.432     1.540     0.087           0.262           0.602               1.300               1.825
## 
##                   cmp to      z       p  -log2(p)
## param  covariate                                 
## alpha_ age         0.000  2.289   0.022     5.500
##        fin         0.000  1.903   0.057     4.133
##        mar         0.000  1.377   0.169     2.568
##        paro        0.000  0.249   0.803     0.316
##        prio        0.000 -2.931   0.003     8.210
##        wexp        0.000  1.213   0.225     2.150
##        Intercept   0.000  9.630 &lt;0.0005    70.507
## beta_  Intercept   0.000  4.993 &lt;0.0005    20.685
## ---
## Concordance = 0.643
## AIC = 1377.450
## log-likelihood ratio test = 31.899 on 6 df
## -log2(p) of ll-ratio test = 15.839</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="accelerated-failure-time-models.html#cb46-1" tabindex="-1"></a></span>
<span id="cb46-2"><a href="accelerated-failure-time-models.html#cb46-2" tabindex="-1"></a>aft.plot()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
<p>Log Normal model:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="accelerated-failure-time-models.html#cb47-1" tabindex="-1"></a><span class="im">from</span> lifelines <span class="im">import</span> LogNormalAFTFitter</span>
<span id="cb47-2"><a href="accelerated-failure-time-models.html#cb47-2" tabindex="-1"></a></span>
<span id="cb47-3"><a href="accelerated-failure-time-models.html#cb47-3" tabindex="-1"></a>aft <span class="op">=</span> LogNormalAFTFitter()</span>
<span id="cb47-4"><a href="accelerated-failure-time-models.html#cb47-4" tabindex="-1"></a>aft.fit(recid1, duration_col<span class="op">=</span><span class="st">&#39;week&#39;</span>, event_col<span class="op">=</span><span class="st">&#39;arrest&#39;</span> )</span></code></pre></div>
<pre><code>## &lt;lifelines.LogNormalAFTFitter: fitted with 432 total observations, 318 right-censored observations&gt;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="accelerated-failure-time-models.html#cb49-1" tabindex="-1"></a>aft.print_summary(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## &lt;lifelines.LogNormalAFTFitter: fitted with 432 total observations, 318 right-censored observations&gt;
##              duration col = &#39;week&#39;
##                 event col = &#39;arrest&#39;
##    number of observations = 432
## number of events observed = 114
##            log-likelihood = -684.206
##          time fit was run = 2024-10-23 13:39:54 UTC
## 
## ---
##                    coef exp(coef)  se(coef)  coef lower 95%  coef upper 95% exp(coef) lower 95% exp(coef) upper 95%
## param  covariate                                                                                                   
## mu_    age        0.026     1.027     0.016          -0.005           0.057               0.995               1.059
##        fin        0.330     1.391     0.164           0.008           0.652               1.008               1.919
##        mar        0.481     1.618     0.296          -0.099           1.062               0.905               2.891
##        paro       0.038     1.039     0.169          -0.294           0.370               0.745               1.448
##        prio      -0.062     0.939     0.027          -0.116          -0.009               0.891               0.991
##        wexp       0.283     1.328     0.180          -0.068           0.635               0.934               1.888
##        Intercept  3.973    53.147     0.409           3.172           4.774              23.852             118.424
## sigma_ Intercept  0.263     1.301     0.076           0.113           0.413               1.120               1.512
## 
##                   cmp to      z       p  -log2(p)
## param  covariate                                 
## mu_    age         0.000  1.663   0.096     3.375
##        fin         0.000  2.006   0.045     4.479
##        mar         0.000  1.624   0.104     3.261
##        paro        0.000  0.225   0.822     0.283
##        prio        0.000 -2.304   0.021     5.559
##        wexp        0.000  1.579   0.114     3.127
##        Intercept   0.000  9.719 &lt;0.0005    71.761
## sigma_ Intercept   0.000  3.442   0.001    10.760
## ---
## Concordance = 0.644
## AIC = 1384.413
## log-likelihood ratio test = 27.408 on 6 df
## -log2(p) of ll-ratio test = 13.008</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="accelerated-failure-time-models.html#cb51-1" tabindex="-1"></a></span>
<span id="cb51-2"><a href="accelerated-failure-time-models.html#cb51-2" tabindex="-1"></a>aft.plot()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-4-5.png" width="672" /></p>
</div>
<div id="interesting-application" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Interesting application<a href="accelerated-failure-time-models.html#interesting-application" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To see the impact of the financial variable, we can look at those who did NOT have financial aid and what would they look like if they did have financial aid (impact of providing financial aid).</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="accelerated-failure-time-models.html#cb52-1" tabindex="-1"></a><span class="co"># Predicted Change in Event Time #</span></span>
<span id="cb52-2"><a href="accelerated-failure-time-models.html#cb52-2" tabindex="-1"></a>new_time <span class="ot">=</span> <span class="fu">qsurvreg</span>(<span class="dv">1</span> <span class="sc">-</span> survprob.actual,</span>
<span id="cb52-3"><a href="accelerated-failure-time-models.html#cb52-3" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-4"><a href="accelerated-failure-time-models.html#cb52-4" tabindex="-1"></a>  <span class="fu">coef</span>(recid.aft.w)[<span class="st">&#39;fin&#39;</span>],</span>
<span id="cb52-5"><a href="accelerated-failure-time-models.html#cb52-5" tabindex="-1"></a>  <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale,</span>
<span id="cb52-6"><a href="accelerated-failure-time-models.html#cb52-6" tabindex="-1"></a>  <span class="at">distribution =</span> recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb52-7"><a href="accelerated-failure-time-models.html#cb52-7" tabindex="-1"></a></span>
<span id="cb52-8"><a href="accelerated-failure-time-models.html#cb52-8" tabindex="-1"></a>recid<span class="sc">$</span>new_time <span class="ot">=</span> new_time</span>
<span id="cb52-9"><a href="accelerated-failure-time-models.html#cb52-9" tabindex="-1"></a>recid<span class="sc">$</span>diff <span class="ot">=</span> recid<span class="sc">$</span>new_time <span class="sc">-</span> recid<span class="sc">$</span>week</span>
<span id="cb52-10"><a href="accelerated-failure-time-models.html#cb52-10" tabindex="-1"></a></span>
<span id="cb52-11"><a href="accelerated-failure-time-models.html#cb52-11" tabindex="-1"></a>impact.fin<span class="ot">=</span><span class="fu">data.frame</span>(recid<span class="sc">$</span>week, recid<span class="sc">$</span>new_time, recid<span class="sc">$</span>diff,recid<span class="sc">$</span>arrest,recid<span class="sc">$</span>fin)</span>
<span id="cb52-12"><a href="accelerated-failure-time-models.html#cb52-12" tabindex="-1"></a><span class="fu">colnames</span>(impact.fin)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;O.Week&quot;</span>,<span class="st">&quot;N.Week&quot;</span>,<span class="st">&quot;Diff&quot;</span>,<span class="st">&quot;Arrest&quot;</span>,<span class="st">&quot;Fin&quot;</span>)</span>
<span id="cb52-13"><a href="accelerated-failure-time-models.html#cb52-13" tabindex="-1"></a></span>
<span id="cb52-14"><a href="accelerated-failure-time-models.html#cb52-14" tabindex="-1"></a></span>
<span id="cb52-15"><a href="accelerated-failure-time-models.html#cb52-15" tabindex="-1"></a>impact.fin2<span class="ot">=</span><span class="fu">subset</span>(impact.fin,Arrest<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Fin<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb52-16"><a href="accelerated-failure-time-models.html#cb52-16" tabindex="-1"></a><span class="fu">head</span>(impact.fin2)</span></code></pre></div>
<pre><code>##    O.Week   N.Week      Diff Arrest Fin
## 1      20 25.66776  5.667764      1   0
## 2      17 21.81760  4.817600      1   0
## 3      25 32.08471  7.084706      1   0
## 7      23 29.51793  6.517929      1   0
## 13     37 47.48536 10.485364      1   0
## 15     25 32.08471  7.084706      1   0</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-survival.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cox-survival-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sjsimmo2/Survival/edit/master/03-AFT.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/sjsimmo2/Survival/blob/master/03-AFT.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
