<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Survival Analysis | Survival Analysis</title>
  <meta name="description" content="Chapter 2 Survival Analysis | Survival Analysis" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Survival Analysis | Survival Analysis" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Survival Analysis | Survival Analysis" />
  
  
  

<meta name="author" content="Susan Simmons" />


<meta name="date" content="2022-10-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="cox-regression.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Survival</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Survival Analysis</a></li>
<li class="chapter" data-level="2" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html"><i class="fa fa-check"></i><b>2</b> Survival Analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#stratified-analysis"><i class="fa fa-check"></i><b>2.1</b> Stratified Analysis</a></li>
<li class="chapter" data-level="2.2" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#hazard-function"><i class="fa fa-check"></i><b>2.2</b> Hazard function</a></li>
<li class="chapter" data-level="2.3" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#aft"><i class="fa fa-check"></i><b>2.3</b> AFT</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="survival-analysis-1.html"><a href="survival-analysis-1.html#breaking-down-the-above-code-into-smaller-pieces"><i class="fa fa-check"></i><b>2.3.1</b> Breaking down the above code into smaller pieces!</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cox-regression.html"><a href="cox-regression.html"><i class="fa fa-check"></i><b>3</b> Cox Regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cox-regression.html"><a href="cox-regression.html#diagnostics"><i class="fa fa-check"></i><b>3.1</b> Diagnostics</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="competing-risks.html"><a href="competing-risks.html"><i class="fa fa-check"></i><b>4</b> Competing Risks</a></li>
<li class="chapter" data-level="5" data-path="repeated-events.html"><a href="repeated-events.html"><i class="fa fa-check"></i><b>5</b> Repeated Events</a></li>
<li class="chapter" data-level="6" data-path="a-caucus-race-and-a-long-tale.html"><a href="a-caucus-race-and-a-long-tale.html"><i class="fa fa-check"></i><b>6</b> A caucus-race and a long tale</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Survival Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="survival-analysis-1" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Survival Analysis<a href="survival-analysis-1.html#survival-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Welcome to the Survival Analysis module! This document will be periodically udated throughout the course. As always, first things we need to do is get all of the packages needed for the course:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="survival-analysis-1.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-2"><a href="survival-analysis-1.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb1-3"><a href="survival-analysis-1.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="survival-analysis-1.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb1-5"><a href="survival-analysis-1.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb1-6"><a href="survival-analysis-1.html#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(flexsurv)</span>
<span id="cb1-7"><a href="survival-analysis-1.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="survival-analysis-1.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ciTools)</span>
<span id="cb1-9"><a href="survival-analysis-1.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-10"><a href="survival-analysis-1.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visreg)</span>
<span id="cb1-11"><a href="survival-analysis-1.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmprsk)</span></code></pre></div>
<p>Also need to get data sets that will be used throughout this course:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="survival-analysis-1.html#cb2-1" aria-hidden="true" tabindex="-1"></a>loyalty<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">My Drive</span><span class="sc">\\</span><span class="st">Fall 3 2016 Survival Analysis</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Data_R</span><span class="sc">\\</span><span class="st">loyalty.csv&quot;</span>,<span class="at">header=</span>T)</span>
<span id="cb2-2"><a href="survival-analysis-1.html#cb2-2" aria-hidden="true" tabindex="-1"></a>recid<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">My Drive</span><span class="sc">\\</span><span class="st">Fall 3 2016 Survival Analysis</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Data_R</span><span class="sc">\\</span><span class="st">recid.csv&quot;</span>,<span class="at">header=</span>T)</span>
<span id="cb2-3"><a href="survival-analysis-1.html#cb2-3" aria-hidden="true" tabindex="-1"></a>recid_long<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">My Drive</span><span class="sc">\\</span><span class="st">Fall 3 2016 Survival Analysis</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Data_R</span><span class="sc">\\</span><span class="st">recid_long.csv&quot;</span>,<span class="at">header=</span>T)</span>
<span id="cb2-4"><a href="survival-analysis-1.html#cb2-4" aria-hidden="true" tabindex="-1"></a>recid_lag<span class="ot">=</span><span class="fu">read.csv</span>(<span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">My Drive</span><span class="sc">\\</span><span class="st">Fall 3 2016 Survival Analysis</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Data_R</span><span class="sc">\\</span><span class="st">recid_lag.csv&quot;</span>,<span class="at">header=</span>T)</span>
<span id="cb2-5"><a href="survival-analysis-1.html#cb2-5" aria-hidden="true" tabindex="-1"></a>leaders <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">My Drive</span><span class="sc">\\</span><span class="st">Fall 3 2016 Survival Analysis</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Data_R</span><span class="sc">\\</span><span class="st">leaders.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-6"><a href="survival-analysis-1.html#cb2-6" aria-hidden="true" tabindex="-1"></a>bladder <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="at">file =</span> <span class="st">&quot;Q:</span><span class="sc">\\</span><span class="st">My Drive</span><span class="sc">\\</span><span class="st">Fall 3 2016 Survival Analysis</span><span class="sc">\\</span><span class="st">Data</span><span class="sc">\\</span><span class="st">Data_R</span><span class="sc">\\</span><span class="st">bladder.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-7"><a href="survival-analysis-1.html#cb2-7" aria-hidden="true" tabindex="-1"></a>simple<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),<span class="at">ncol=</span><span class="dv">2</span>))</span>
<span id="cb2-8"><a href="survival-analysis-1.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(simple)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;tenure&quot;</span>,<span class="st">&quot;censored&quot;</span>)</span></code></pre></div>
<p>To perform a survival analysis, you need to identify which variable has the “time” information and which variable contains the “censoring” information. This is done through the Surv function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="survival-analysis-1.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Survival Analysis Object </span></span>
<span id="cb3-2"><a href="survival-analysis-1.html#cb3-2" aria-hidden="true" tabindex="-1"></a>simple.s<span class="ot">=</span><span class="fu">Surv</span>(<span class="at">time=</span>simple<span class="sc">$</span>tenure,<span class="at">event=</span>simple<span class="sc">$</span>censored)</span>
<span id="cb3-3"><a href="survival-analysis-1.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="survival-analysis-1.html#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="survival-analysis-1.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Kaplan-Meier Survival Curve with Censoring </span></span>
<span id="cb3-6"><a href="survival-analysis-1.html#cb3-6" aria-hidden="true" tabindex="-1"></a>simple_km<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(<span class="at">time =</span> tenure, <span class="at">event =</span> censored)<span class="sc">~</span><span class="dv">1</span>,                      <span class="at">data =</span> simple)</span>
<span id="cb3-7"><a href="survival-analysis-1.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_km)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(time = tenure, event = censored) ~ 1, 
##     data = simple)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     2      6       1    0.833   0.152       0.5827            1
##     3      5       1    0.667   0.192       0.3786            1
##     7      3       1    0.444   0.222       0.1668            1
##     8      2       1    0.222   0.192       0.0407            1</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="survival-analysis-1.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(simple_km, <span class="at">main =</span> <span class="st">&quot;Survival Function&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Tenure&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Survival Probability&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/survival%20curves-1.png" width="672" /></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="survival-analysis-1.html#cb6-1" aria-hidden="true" tabindex="-1"></a>loyalty.fit<span class="ot">=</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(Tenure, censored)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>loyalty)</span>
<span id="cb6-2"><a href="survival-analysis-1.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(loyalty.fit)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(Tenure, censored) ~ 1, data = loyalty)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     1    250       2   0.9920 0.00563      0.98102        1.000
##     2    245       5   0.9718 0.01052      0.95135        0.993
##     3    235       8   0.9387 0.01535      0.90907        0.969
##     4    220       5   0.9173 0.01772      0.88327        0.953
##     5    207       4   0.8996 0.01946      0.86226        0.939
##     6    197       2   0.8905 0.02031      0.85155        0.931
##     7    189       1   0.8858 0.02074      0.84603        0.927
##     8    177       6   0.8557 0.02338      0.81112        0.903
##     9    169       4   0.8355 0.02493      0.78804        0.886
##    10    160       1   0.8303 0.02531      0.78211        0.881
##    11    156       4   0.8090 0.02681      0.75811        0.863
##    12    144       2   0.7977 0.02759      0.74547        0.854
##    13    137       5   0.7686 0.02949      0.71294        0.829
##    14    128       2   0.7566 0.03023      0.69963        0.818
##    15    120       6   0.7188 0.03242      0.65796        0.785
##    16    107       3   0.6986 0.03354      0.63590        0.768
##    17    103       1   0.6919 0.03389      0.62851        0.762
##    18     96       1   0.6846 0.03430      0.62062        0.755
##    19     94       2   0.6701 0.03508      0.60473        0.742
##    20     89       2   0.6550 0.03587      0.58836        0.729
##    21     86       1   0.6474 0.03625      0.58011        0.723
##    22     82       2   0.6316 0.03705      0.56302        0.709
##    23     76       1   0.6233 0.03748      0.55400        0.701
##    24     73       1   0.6148 0.03793      0.54474        0.694
##    25     71       3   0.5888 0.03918      0.51680        0.671
##    27     63       1   0.5794 0.03966      0.50671        0.663
##    28     59       2   0.5598 0.04067      0.48550        0.645
##    29     57       2   0.5402 0.04155      0.46457        0.628
##    30     54       1   0.5302 0.04197      0.45397        0.619
##    31     52       2   0.5098 0.04276      0.43249        0.601
##    32     50       3   0.4792 0.04369      0.40077        0.573
##    35     44       3   0.4465 0.04459      0.36713        0.543
##    36     40       3   0.4130 0.04525      0.33321        0.512
##    42     31       1   0.3997 0.04571      0.31944        0.500
##    43     29       1   0.3859 0.04616      0.30526        0.488
##    44     27       1   0.3716 0.04661      0.29062        0.475
##    48     24       1   0.3561 0.04717      0.27471        0.462
##    51     18       1   0.3364 0.04852      0.25351        0.446
##    53     17       1   0.3166 0.04954      0.23295        0.430
##    60     12       1   0.2902 0.05196      0.20429        0.412
##    64     11       1   0.2638 0.05352      0.17726        0.393
##    78      8       1   0.2308 0.05607      0.14339        0.372
##    80      7       1   0.1979 0.05694      0.11256        0.348
##    83      6       1   0.1649 0.05619      0.08454        0.322
##    95      4       1   0.1237 0.05523      0.05153        0.297
##   105      3       1   0.0824 0.04988      0.02518        0.270
##   114      2       1   0.0412 0.03836      0.00665        0.255
##   129      1       1   0.0000     NaN           NA           NA</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="survival-analysis-1.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(loyalty.fit)</span>
<span id="cb8-2"><a href="survival-analysis-1.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="survival-analysis-1.html#cb8-3" aria-hidden="true" tabindex="-1"></a>recid.fit <span class="ot">=</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(week, arrest)<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>recid)</span>
<span id="cb8-4"><a href="survival-analysis-1.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(recid.fit)</span></code></pre></div>
<pre><code>## Call: survfit(formula = Surv(week, arrest) ~ 1, data = recid)
## 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     1    432       1    0.998 0.00231        0.993        1.000
##     2    431       1    0.995 0.00327        0.989        1.000
##     3    430       1    0.993 0.00400        0.985        1.000
##     4    429       1    0.991 0.00461        0.982        1.000
##     5    428       1    0.988 0.00515        0.978        0.999
##     6    427       1    0.986 0.00563        0.975        0.997
##     7    426       1    0.984 0.00607        0.972        0.996
##     8    425       5    0.972 0.00791        0.957        0.988
##     9    420       2    0.968 0.00852        0.951        0.984
##    10    418       1    0.965 0.00881        0.948        0.983
##    11    417       2    0.961 0.00935        0.942        0.979
##    12    415       2    0.956 0.00987        0.937        0.976
##    13    413       1    0.954 0.01011        0.934        0.974
##    14    412       3    0.947 0.01080        0.926        0.968
##    15    409       2    0.942 0.01123        0.920        0.964
##    16    407       2    0.937 0.01165        0.915        0.961
##    17    405       3    0.931 0.01223        0.907        0.955
##    18    402       3    0.924 0.01278        0.899        0.949
##    19    399       2    0.919 0.01313        0.894        0.945
##    20    397       5    0.907 0.01395        0.880        0.935
##    21    392       2    0.903 0.01425        0.875        0.931
##    22    390       1    0.900 0.01440        0.873        0.929
##    23    389       1    0.898 0.01455        0.870        0.927
##    24    388       4    0.889 0.01512        0.860        0.919
##    25    384       3    0.882 0.01552        0.852        0.913
##    26    381       3    0.875 0.01591        0.844        0.907
##    27    378       2    0.870 0.01616        0.839        0.903
##    28    376       2    0.866 0.01640        0.834        0.898
##    30    374       2    0.861 0.01664        0.829        0.894
##    31    372       1    0.859 0.01675        0.827        0.892
##    32    371       2    0.854 0.01698        0.822        0.888
##    33    369       2    0.850 0.01720        0.816        0.884
##    34    367       2    0.845 0.01742        0.811        0.880
##    35    365       4    0.836 0.01783        0.801        0.871
##    36    361       3    0.829 0.01813        0.794        0.865
##    37    358       4    0.819 0.01851        0.784        0.857
##    38    354       1    0.817 0.01860        0.781        0.854
##    39    353       2    0.812 0.01878        0.777        0.850
##    40    351       4    0.803 0.01913        0.767        0.842
##    42    347       2    0.799 0.01929        0.762        0.837
##    43    345       4    0.789 0.01962        0.752        0.829
##    44    341       2    0.785 0.01977        0.747        0.824
##    45    339       2    0.780 0.01993        0.742        0.820
##    46    337       4    0.771 0.02022        0.732        0.812
##    47    333       1    0.769 0.02029        0.730        0.809
##    48    332       2    0.764 0.02043        0.725        0.805
##    49    330       5    0.752 0.02077        0.713        0.794
##    50    325       3    0.745 0.02096        0.705        0.788
##    52    322       4    0.736 0.02121        0.696        0.779</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="survival-analysis-1.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(recid.fit, <span class="at">data =</span> recid, <span class="at">conf.int =</span> T, <span class="at">palette =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Survival Probability&quot;</span>, <span class="at">legend =</span> <span class="st">&quot;none&quot;</span>, <span class="at">break.y.by =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/survival%20curves-2.png" width="672" /><img src="bookdownproj_files/figure-html/survival%20curves-3.png" width="672" /></p>
<div id="stratified-analysis" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Stratified Analysis<a href="survival-analysis-1.html#stratified-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We can look at Survival curves segmented into different groups or strata. You need to define the variable that creates the strata in order to create this analysis.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="survival-analysis-1.html#cb11-1" aria-hidden="true" tabindex="-1"></a>Loyal.KP2 <span class="ot">=</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(Tenure, censored) <span class="sc">~</span> Loyalty,<span class="at">data=</span>loyalty)</span>
<span id="cb11-2"><a href="survival-analysis-1.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(Loyal.KP2,<span class="at">data=</span>loyalty,<span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;orange&quot;</span>),<span class="at">conf.int =</span> T)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/stratified%20analysis-1.png" width="672" /></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="survival-analysis-1.html#cb12-1" aria-hidden="true" tabindex="-1"></a>Recid.KP <span class="ot">=</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> wexp,<span class="at">data=</span>recid)</span>
<span id="cb12-2"><a href="survival-analysis-1.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(Recid.KP,<span class="at">data=</span>recid,<span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;orange&quot;</span>),<span class="at">conf.int =</span> T,<span class="at">legend.title =</span> <span class="st">&quot;work experience&quot;</span>, <span class="at">legend.labs =</span> <span class="fu">c</span>(<span class="st">&quot;no&quot;</span>, <span class="st">&quot;yes&quot;</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/stratified%20analysis-2.png" width="672" /></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="survival-analysis-1.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test for Differences in Survival Curves #</span></span>
<span id="cb13-2"><a href="survival-analysis-1.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(Tenure, censored) <span class="sc">~</span> Loyalty, <span class="at">data=</span>loyalty, <span class="at">rho=</span><span class="dv">0</span>) </span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(Tenure, censored) ~ Loyalty, data = loyalty, 
##     rho = 0)
## 
##             N Observed Expected (O-E)^2/E (O-E)^2/V
## Loyalty=0 183       67       65    0.0595     0.176
## Loyalty=1  67       39       41    0.0944     0.176
## 
##  Chisq= 0.2  on 1 degrees of freedom, p= 0.7</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="survival-analysis-1.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-Rank Test </span></span>
<span id="cb15-2"><a href="survival-analysis-1.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(Tenure, censored) <span class="sc">~</span> Loyalty, <span class="at">data=</span>loyalty, <span class="at">rho=</span><span class="dv">1</span>) </span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(Tenure, censored) ~ Loyalty, data = loyalty, 
##     rho = 1)
## 
##             N Observed Expected (O-E)^2/E (O-E)^2/V
## Loyalty=0 183     49.6     49.3   0.00155    0.0063
## Loyalty=1  67     24.9     25.1   0.00303    0.0063
## 
##  Chisq= 0  on 1 degrees of freedom, p= 0.9</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="survival-analysis-1.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wilcoxon Test </span></span>
<span id="cb17-2"><a href="survival-analysis-1.html#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="survival-analysis-1.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> wexp, <span class="at">data=</span>recid,<span class="at">rho=</span><span class="dv">0</span>) <span class="co"># Log-Rank Test </span></span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(week, arrest) ~ wexp, data = recid, rho = 0)
## 
##          N Observed Expected (O-E)^2/E (O-E)^2/V
## wexp=0 185       62     45.6      5.91      9.91
## wexp=1 247       52     68.4      3.94      9.91
## 
##  Chisq= 9.9  on 1 degrees of freedom, p= 0.002</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="survival-analysis-1.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">survdiff</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> wexp,<span class="at">data=</span>recid,<span class="at">rho=</span><span class="dv">1</span>) <span class="co"># Wilcoxon Test </span></span></code></pre></div>
<pre><code>## Call:
## survdiff(formula = Surv(week, arrest) ~ wexp, data = recid, rho = 1)
## 
##          N Observed Expected (O-E)^2/E (O-E)^2/V
## wexp=0 185     55.0     39.9      5.75        11
## wexp=1 247     44.4     59.5      3.85        11
## 
##  Chisq= 11  on 1 degrees of freedom, p= 9e-04</code></pre>
</div>
<div id="hazard-function" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Hazard function<a href="survival-analysis-1.html#hazard-function" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We are able to calculate hazard probabilities and cumulative hazard functions in R.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="survival-analysis-1.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculating Hazard Probabilities </span></span>
<span id="cb21-2"><a href="survival-analysis-1.html#cb21-2" aria-hidden="true" tabindex="-1"></a>h<span class="ot">=</span> simple_km<span class="sc">$</span>n.event<span class="sc">/</span>simple_km<span class="sc">$</span>n.risk</span>
<span id="cb21-3"><a href="survival-analysis-1.html#cb21-3" aria-hidden="true" tabindex="-1"></a>index.h<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="at">length=</span>(<span class="fu">max</span>(simple<span class="sc">$</span>tenure)<span class="sc">+</span><span class="dv">1</span>)) <span class="co">#Need to add 0</span></span>
<span id="cb21-4"><a href="survival-analysis-1.html#cb21-4" aria-hidden="true" tabindex="-1"></a>index.h[(simple_km<span class="sc">$</span>time)<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>h <span class="co">#Because of 0</span></span>
<span id="cb21-5"><a href="survival-analysis-1.html#cb21-5" aria-hidden="true" tabindex="-1"></a>haz.plot<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(simple<span class="sc">$</span>tenure)), index.h))</span>
<span id="cb21-6"><a href="survival-analysis-1.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(haz.plot)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Time&quot;</span>,<span class="st">&quot;Hazard&quot;</span>)</span>
<span id="cb21-7"><a href="survival-analysis-1.html#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(haz.plot,<span class="fu">aes</span>(<span class="at">x=</span>Time,<span class="at">y=</span>Hazard))<span class="sc">+</span><span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/hazard%20functions-1.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="survival-analysis-1.html#cb22-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">=</span> loyalty.fit<span class="sc">$</span>n.event<span class="sc">/</span>loyalty.fit<span class="sc">$</span>n.risk</span>
<span id="cb22-2"><a href="survival-analysis-1.html#cb22-2" aria-hidden="true" tabindex="-1"></a>index.h<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="at">length=</span>(<span class="fu">max</span>(loyalty<span class="sc">$</span>Tenure)<span class="sc">+</span><span class="dv">1</span>)) <span class="co">#Need to add 0</span></span>
<span id="cb22-3"><a href="survival-analysis-1.html#cb22-3" aria-hidden="true" tabindex="-1"></a>index.h[(loyalty.fit<span class="sc">$</span>time)<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>h <span class="co">#Because of 0</span></span>
<span id="cb22-4"><a href="survival-analysis-1.html#cb22-4" aria-hidden="true" tabindex="-1"></a>haz.plot<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(loyalty<span class="sc">$</span>Tenure)), index.h))</span>
<span id="cb22-5"><a href="survival-analysis-1.html#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(haz.plot)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Time&quot;</span>,<span class="st">&quot;Hazard&quot;</span>)</span>
<span id="cb22-6"><a href="survival-analysis-1.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(haz.plot,<span class="fu">aes</span>(<span class="at">x=</span>Time,<span class="at">y=</span>Hazard))<span class="sc">+</span><span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/hazard%20functions-2.png" width="672" /></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="survival-analysis-1.html#cb23-1" aria-hidden="true" tabindex="-1"></a>h <span class="ot">=</span> recid.fit<span class="sc">$</span>n.event<span class="sc">/</span>recid.fit<span class="sc">$</span>n.risk</span>
<span id="cb23-2"><a href="survival-analysis-1.html#cb23-2" aria-hidden="true" tabindex="-1"></a>index.h<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="at">length=</span>(<span class="fu">max</span>(recid<span class="sc">$</span>week)<span class="sc">+</span><span class="dv">1</span>)) <span class="co">#Need to add 0</span></span>
<span id="cb23-3"><a href="survival-analysis-1.html#cb23-3" aria-hidden="true" tabindex="-1"></a>index.h[(recid.fit<span class="sc">$</span>time)<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>h <span class="co">#Because of 0</span></span>
<span id="cb23-4"><a href="survival-analysis-1.html#cb23-4" aria-hidden="true" tabindex="-1"></a>haz.plot<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(recid<span class="sc">$</span>week)), index.h))</span>
<span id="cb23-5"><a href="survival-analysis-1.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(haz.plot)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Time&quot;</span>,<span class="st">&quot;Hazard&quot;</span>)</span>
<span id="cb23-6"><a href="survival-analysis-1.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(haz.plot,<span class="fu">aes</span>(<span class="at">x=</span>Time,<span class="at">y=</span>Hazard))<span class="sc">+</span><span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/hazard%20functions-3.png" width="672" /></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="survival-analysis-1.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(recid.fit, <span class="at">data =</span> recid, <span class="at">fun =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">conf.int =</span> <span class="cn">TRUE</span>,  <span class="at">palette =</span> <span class="st">&quot;purple&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Week&quot;</span>,           <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">legend =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/hazard%20functions-4.png" width="672" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="survival-analysis-1.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">###Cumulative hazard function</span></span>
<span id="cb25-2"><a href="survival-analysis-1.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="survival-analysis-1.html#cb25-3" aria-hidden="true" tabindex="-1"></a>h<span class="ot">=</span> simple_km<span class="sc">$</span>n.event<span class="sc">/</span>simple_km<span class="sc">$</span>n.risk</span>
<span id="cb25-4"><a href="survival-analysis-1.html#cb25-4" aria-hidden="true" tabindex="-1"></a>index.h<span class="ot">=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="at">length=</span>(<span class="fu">max</span>(simple<span class="sc">$</span>tenure)<span class="sc">+</span><span class="dv">1</span>)) <span class="co">#Need to add 0</span></span>
<span id="cb25-5"><a href="survival-analysis-1.html#cb25-5" aria-hidden="true" tabindex="-1"></a>index.h[(simple_km<span class="sc">$</span>time)<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span>h <span class="co">#Because of 0</span></span>
<span id="cb25-6"><a href="survival-analysis-1.html#cb25-6" aria-hidden="true" tabindex="-1"></a>cum.haz<span class="ot">=</span><span class="fu">cumsum</span>(index.h)</span>
<span id="cb25-7"><a href="survival-analysis-1.html#cb25-7" aria-hidden="true" tabindex="-1"></a>haz.plot<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="fu">max</span>(simple<span class="sc">$</span>tenure)), cum.haz))</span>
<span id="cb25-8"><a href="survival-analysis-1.html#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(haz.plot)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Time&quot;</span>,<span class="st">&quot;Hazard&quot;</span>)</span>
<span id="cb25-9"><a href="survival-analysis-1.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(haz.plot,<span class="fu">aes</span>(<span class="at">x=</span>Time,<span class="at">y=</span>Hazard))<span class="sc">+</span><span class="fu">geom_line</span>()<span class="sc">+</span><span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;Cumulative Hazard&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/hazard%20functions-5.png" width="672" /></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="survival-analysis-1.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsurvplot</span>(</span>
<span id="cb26-2"><a href="survival-analysis-1.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  Recid.KP,</span>
<span id="cb26-3"><a href="survival-analysis-1.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> recid,</span>
<span id="cb26-4"><a href="survival-analysis-1.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">1</span>,                 </span>
<span id="cb26-5"><a href="survival-analysis-1.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span></span>
<span id="cb26-6"><a href="survival-analysis-1.html#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;orange&quot;</span>),</span>
<span id="cb26-7"><a href="survival-analysis-1.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>,          </span>
<span id="cb26-8"><a href="survival-analysis-1.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">pval =</span> <span class="cn">TRUE</span>,              </span>
<span id="cb26-9"><a href="survival-analysis-1.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk.table =</span> <span class="cn">TRUE</span>,        </span>
<span id="cb26-10"><a href="survival-analysis-1.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk.table.col =</span> <span class="st">&quot;wexp&quot;</span>,</span>
<span id="cb26-11"><a href="survival-analysis-1.html#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend.labs =</span></span>
<span id="cb26-12"><a href="survival-analysis-1.html#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>, <span class="st">&quot;Yes&quot;</span>),    </span>
<span id="cb26-13"><a href="survival-analysis-1.html#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk.table.height =</span> <span class="fl">0.25</span>, </span>
<span id="cb26-14"><a href="survival-analysis-1.html#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()      </span>
<span id="cb26-15"><a href="survival-analysis-1.html#cb26-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/hazard%20functions-6.png" width="672" /></p>
</div>
<div id="aft" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> AFT<a href="survival-analysis-1.html#aft" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following R codes illustrate how to fit the Accelerated Failure Time models.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="survival-analysis-1.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accelerated Failure Time Model </span></span>
<span id="cb27-2"><a href="survival-analysis-1.html#cb27-2" aria-hidden="true" tabindex="-1"></a>recid.aft.ln <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> mar <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&#39;lognormal&#39;</span>)</span>
<span id="cb27-3"><a href="survival-analysis-1.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(recid.aft.ln)</span></code></pre></div>
<pre><code>## 
## Call:
## survreg(formula = Surv(week, arrest) ~ fin + age + mar + prio, 
##     data = recid, dist = &quot;lognormal&quot;)
##               Value Std. Error     z       p
## (Intercept)  4.0146     0.3897 10.30 &lt; 2e-16
## fin          0.3319     0.1657  2.00 0.04524
## age          0.0333     0.0153  2.18 0.02959
## mar          0.5609     0.2928  1.92 0.05541
## prio        -0.0743     0.0264 -2.82 0.00481
## Log(scale)   0.2723     0.0765  3.56 0.00037
## 
## Scale= 1.31 
## 
## Log Normal distribution
## Loglik(model)= -685.5   Loglik(intercept only)= -697.9
##  Chisq= 24.85 on 4 degrees of freedom, p= 5.4e-05 
## Number of Newton-Raphson Iterations: 4 
## n= 432</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="survival-analysis-1.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Parameter interpretation</span></span>
<span id="cb29-2"><a href="survival-analysis-1.html#cb29-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">exp</span>(<span class="fu">coef</span>(recid.aft.ln))<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span></span></code></pre></div>
<pre><code>## (Intercept)         fin         age         mar        prio 
## 5439.988576   39.357426    3.386427   75.223685   -7.163067</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="survival-analysis-1.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exponential vs. Weibull </span></span>
<span id="cb31-2"><a href="survival-analysis-1.html#cb31-2" aria-hidden="true" tabindex="-1"></a>recid.aft.w <span class="ot">&lt;-</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age  <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&#39;weibull&#39;</span>)</span>
<span id="cb31-3"><a href="survival-analysis-1.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(recid.aft.w)</span></code></pre></div>
<pre><code>## 
## Call:
## survreg(formula = Surv(week, arrest) ~ fin + age + wexp + mar + 
##     paro + prio, data = recid, dist = &quot;weibull&quot;)
##               Value Std. Error     z       p
## (Intercept)  3.8086     0.3762 10.12 &lt; 2e-16
## fin          0.2625     0.1376  1.91 0.05650
## age          0.0400     0.0159  2.51 0.01210
## wexp         0.1115     0.1516  0.74 0.46196
## mar          0.3389     0.2725  1.24 0.21366
## paro         0.0538     0.1394  0.39 0.69956
## prio        -0.0646     0.0210 -3.08 0.00208
## Log(scale)  -0.3383     0.0891 -3.80 0.00015
## 
## Scale= 0.713 
## 
## Weibull distribution
## Loglik(model)= -680.5   Loglik(intercept only)= -696.6
##  Chisq= 32.28 on 6 degrees of freedom, p= 1.4e-05 
## Number of Newton-Raphson Iterations: 6 
## n= 432</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="survival-analysis-1.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Checking Distributions </span></span>
<span id="cb33-2"><a href="survival-analysis-1.html#cb33-2" aria-hidden="true" tabindex="-1"></a>recid.aft.w <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;weibull&quot;</span>)</span>
<span id="cb33-3"><a href="survival-analysis-1.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="survival-analysis-1.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb33-5"><a href="survival-analysis-1.html#cb33-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Weibull Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-1.png" width="672" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="survival-analysis-1.html#cb34-1" aria-hidden="true" tabindex="-1"></a>recid.aft.e <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;exp&quot;</span>)</span>
<span id="cb34-2"><a href="survival-analysis-1.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="survival-analysis-1.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.e, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb34-4"><a href="survival-analysis-1.html#cb34-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Exponential Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-2.png" width="672" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="survival-analysis-1.html#cb35-1" aria-hidden="true" tabindex="-1"></a>recid.aft.g <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;gamma&quot;</span>)</span>
<span id="cb35-2"><a href="survival-analysis-1.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="survival-analysis-1.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.g, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb35-4"><a href="survival-analysis-1.html#cb35-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Gamma Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-3.png" width="672" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="survival-analysis-1.html#cb36-1" aria-hidden="true" tabindex="-1"></a>recid.aft.ll <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span> race <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;llogis&quot;</span>)</span>
<span id="cb36-2"><a href="survival-analysis-1.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="survival-analysis-1.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(recid.aft.ll, <span class="at">type =</span> <span class="st">&quot;cumhaz&quot;</span>, <span class="at">ci =</span> <span class="cn">TRUE</span>, <span class="at">conf.int =</span> <span class="cn">FALSE</span>, <span class="at">las =</span> <span class="dv">1</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb36-4"><a href="survival-analysis-1.html#cb36-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;week&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Cumulative Hazard&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Log-Logistic Distribution&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/AFT-4.png" width="672" /></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="survival-analysis-1.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Goodness-of-Fit Tests </span></span>
<span id="cb37-2"><a href="survival-analysis-1.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="survival-analysis-1.html#cb37-3" aria-hidden="true" tabindex="-1"></a>like.e <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>  wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;exp&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb37-4"><a href="survival-analysis-1.html#cb37-4" aria-hidden="true" tabindex="-1"></a>like.w <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>  wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;weibull&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb37-5"><a href="survival-analysis-1.html#cb37-5" aria-hidden="true" tabindex="-1"></a>like.ln <span class="ot">&lt;-</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>  wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;lnorm&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb37-6"><a href="survival-analysis-1.html#cb37-6" aria-hidden="true" tabindex="-1"></a>like.g <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age  <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;gamma&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb37-7"><a href="survival-analysis-1.html#cb37-7" aria-hidden="true" tabindex="-1"></a>like.ll <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age  <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;llogis&quot;</span>)<span class="sc">$</span>loglik</span>
<span id="cb37-8"><a href="survival-analysis-1.html#cb37-8" aria-hidden="true" tabindex="-1"></a>like.f <span class="ot">=</span> <span class="fu">flexsurvreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age  <span class="sc">+</span> wexp <span class="sc">+</span> mar <span class="sc">+</span> paro <span class="sc">+</span> prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&quot;genf&quot;</span>)<span class="sc">$</span>loglik</span></code></pre></div>
<pre><code>## Warning in flexsurvreg(Surv(week, arrest) ~ fin + age + wexp + mar + paro + :
## Optimisation has probably not converged to the maximum likelihood - Hessian is
## not positive definite.</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="survival-analysis-1.html#cb39-1" aria-hidden="true" tabindex="-1"></a>pval.e.g <span class="ot">=</span> <span class="fu">pchisq</span>((<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(like.e<span class="sc">-</span>like.g)), <span class="dv">2</span>,<span class="at">lower.tail=</span>F)</span>
<span id="cb39-2"><a href="survival-analysis-1.html#cb39-2" aria-hidden="true" tabindex="-1"></a>pval.w.g <span class="ot">=</span> <span class="fu">pchisq</span>((<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(like.w<span class="sc">-</span>like.g)), <span class="dv">1</span>,<span class="at">lower.tail=</span>F)</span>
<span id="cb39-3"><a href="survival-analysis-1.html#cb39-3" aria-hidden="true" tabindex="-1"></a>pval.ln.g <span class="ot">=</span> <span class="fu">pchisq</span>((<span class="sc">-</span><span class="dv">2</span><span class="sc">*</span>(like.ln<span class="sc">-</span>like.g)), <span class="dv">1</span>,<span class="at">lower.tail=</span>F)</span>
<span id="cb39-4"><a href="survival-analysis-1.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="do">##pval.g.f = pchisq((-2*(like.g-like.f)), 1,lower.tail=F)</span></span>
<span id="cb39-5"><a href="survival-analysis-1.html#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="survival-analysis-1.html#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="survival-analysis-1.html#cb39-7" aria-hidden="true" tabindex="-1"></a>Tests <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;Exp vs. Gam&#39;</span>, <span class="st">&#39;Wei vs. Gam&#39;</span>, <span class="st">&#39;LogN vs. Gam&#39;</span>)</span>
<span id="cb39-8"><a href="survival-analysis-1.html#cb39-8" aria-hidden="true" tabindex="-1"></a>P_values <span class="ot">=</span> <span class="fu">c</span>(pval.e.g, pval.w.g, pval.ln.g)</span>
<span id="cb39-9"><a href="survival-analysis-1.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(Tests, P_values)</span></code></pre></div>
<pre><code>##      Tests          P_values             
## [1,] &quot;Exp vs. Gam&quot;  &quot;0.00194259347065262&quot;
## [2,] &quot;Wei vs. Gam&quot;  &quot;1&quot;                  
## [3,] &quot;LogN vs. Gam&quot; &quot;0.00767095999547646&quot;</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="survival-analysis-1.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted Survival Quantiles </span></span>
<span id="cb41-2"><a href="survival-analysis-1.html#cb41-2" aria-hidden="true" tabindex="-1"></a>recid.aft.w <span class="ot">=</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&#39;weibull&#39;</span>)</span>
<span id="cb41-3"><a href="survival-analysis-1.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(recid.aft.w)</span></code></pre></div>
<pre><code>## 
## Call:
## survreg(formula = Surv(week, arrest) ~ fin + age + prio, data = recid, 
##     dist = &quot;weibull&quot;)
##               Value Std. Error     z       p
## (Intercept)  3.7738     0.3581 10.54 &lt; 2e-16
## fin          0.2495     0.1372  1.82 0.06901
## age          0.0478     0.0154  3.11 0.00189
## prio        -0.0698     0.0201 -3.47 0.00051
## Log(scale)  -0.3367     0.0892 -3.77 0.00016
## 
## Scale= 0.714 
## 
## Weibull distribution
## Loglik(model)= -682   Loglik(intercept only)= -696.6
##  Chisq= 29.17 on 3 degrees of freedom, p= 2.1e-06 
## Number of Newton-Raphson Iterations: 6 
## n= 432</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="survival-analysis-1.html#cb43-1" aria-hidden="true" tabindex="-1"></a>survprob.<span class="dv">75</span>.<span class="fl">50.25</span> <span class="ot">=</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>,<span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb43-2"><a href="survival-analysis-1.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survprob.<span class="dv">75</span>.<span class="fl">50.25</span><span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>##          [,1]      [,2]      [,3]
## [1,] 52.68849  98.72758 161.95827
## [2,] 24.17956  45.30760  74.32514
## [3,] 17.89085  33.52383  54.99438
## [4,] 64.22717 120.34873 197.42682
## [5,] 35.95471  67.37185 110.52057
## [6,] 48.95457  91.73097 150.48064</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="survival-analysis-1.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted Mean Event Time #</span></span>
<span id="cb45-2"><a href="survival-analysis-1.html#cb45-2" aria-hidden="true" tabindex="-1"></a>p.time.mean <span class="ot">=</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-3"><a href="survival-analysis-1.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(p.time.mean<span class="sc">$</span>fit, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 128.26394  58.86229  43.55317 156.35349  87.52751 119.17415 143.73152
##  [8] 115.26040  81.92984 113.19494</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="survival-analysis-1.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted Survival Probabilities #</span></span>
<span id="cb47-2"><a href="survival-analysis-1.html#cb47-2" aria-hidden="true" tabindex="-1"></a>survprob.actual <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">psurvreg</span>(recid<span class="sc">$</span>week,</span>
<span id="cb47-3"><a href="survival-analysis-1.html#cb47-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>),</span>
<span id="cb47-4"><a href="survival-analysis-1.html#cb47-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale, <span class="at">distribution =</span>     recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb47-5"><a href="survival-analysis-1.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survprob.actual, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.9285822 0.8389085 0.6315234 0.8073231 0.6173609 0.7312118 0.9260438
##  [8] 0.7203354 0.5891529 0.7143008</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="survival-analysis-1.html#cb49-1" aria-hidden="true" tabindex="-1"></a>survprob<span class="fl">.10</span>wk <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">psurvreg</span>(<span class="dv">10</span>,</span>
<span id="cb49-2"><a href="survival-analysis-1.html#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>),</span>
<span id="cb49-3"><a href="survival-analysis-1.html#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale,</span>
<span id="cb49-4"><a href="survival-analysis-1.html#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">distribution =</span> recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb49-5"><a href="survival-analysis-1.html#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survprob<span class="fl">.10</span>wk)</span></code></pre></div>
<pre><code>## [1] 0.9723202 0.9198457 0.8803901 0.9789527 0.9531961 0.9693657</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="survival-analysis-1.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted Change in Event Time #</span></span>
<span id="cb51-2"><a href="survival-analysis-1.html#cb51-2" aria-hidden="true" tabindex="-1"></a>new_time <span class="ot">=</span> <span class="fu">qsurvreg</span>(<span class="dv">1</span> <span class="sc">-</span> survprob.actual,</span>
<span id="cb51-3"><a href="survival-analysis-1.html#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-4"><a href="survival-analysis-1.html#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(recid.aft.w)[<span class="st">&#39;fin&#39;</span>],</span>
<span id="cb51-5"><a href="survival-analysis-1.html#cb51-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale,</span>
<span id="cb51-6"><a href="survival-analysis-1.html#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distribution =</span> recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb51-7"><a href="survival-analysis-1.html#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="survival-analysis-1.html#cb51-8" aria-hidden="true" tabindex="-1"></a>recid<span class="sc">$</span>new_time <span class="ot">=</span> new_time</span>
<span id="cb51-9"><a href="survival-analysis-1.html#cb51-9" aria-hidden="true" tabindex="-1"></a>recid<span class="sc">$</span>diff <span class="ot">=</span> recid<span class="sc">$</span>new_time <span class="sc">-</span> recid<span class="sc">$</span>week</span>
<span id="cb51-10"><a href="survival-analysis-1.html#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="survival-analysis-1.html#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data.frame</span>(recid<span class="sc">$</span>week, recid<span class="sc">$</span>new_time, recid<span class="sc">$</span>diff), <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    recid.week recid.new_time recid.diff
## 1          20       25.66776   5.667764
## 2          17       21.81760   4.817600
## 3          25       32.08471   7.084706
## 4          52       66.73619  14.736188
## 5          52       66.73619  14.736188
## 6          52       66.73619  14.736188
## 7          23       29.51793   6.517929
## 8          52       66.73619  14.736188
## 9          52       66.73619  14.736188
## 10         52       66.73619  14.736188</code></pre>
<div id="breaking-down-the-above-code-into-smaller-pieces" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Breaking down the above code into smaller pieces!<a href="survival-analysis-1.html#breaking-down-the-above-code-into-smaller-pieces" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the survival regression, when we use the predict command (with nothing else), this is predicting the mean survival time. This means, on average when do we think the event will occur? For example, we will continue to use the recidivism data set with the Weibull distribution with the variables fin, age and prior. The following command will predict the mean time of the event occurring (only printing off a few to see).</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="survival-analysis-1.html#cb53-1" aria-hidden="true" tabindex="-1"></a>recid.aft.w <span class="ot">=</span> <span class="fu">survreg</span>(<span class="fu">Surv</span>(week, arrest) <span class="sc">~</span> fin <span class="sc">+</span> age <span class="sc">+</span>prio, <span class="at">data =</span> recid, <span class="at">dist =</span> <span class="st">&#39;weibull&#39;</span>)</span>
<span id="cb53-2"><a href="survival-analysis-1.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">predict</span>(recid.aft.w))</span></code></pre></div>
<pre><code>## [1] 128.26394  58.86229  43.55317 156.35349  87.52751 119.17415</code></pre>
<p>But does it make sense to predict on average when we think an event will occur (or when an event will fail)? Probably not. Another approach would be to print the quantiles (for example the 25th, 50th and 75th quantile).</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="survival-analysis-1.html#cb55-1" aria-hidden="true" tabindex="-1"></a>survprob.<span class="dv">75</span>.<span class="fl">50.25</span> <span class="ot">=</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>,<span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb55-2"><a href="survival-analysis-1.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survprob.<span class="dv">75</span>.<span class="fl">50.25</span><span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>##          [,1]      [,2]      [,3]
## [1,] 52.68849  98.72758 161.95827
## [2,] 24.17956  45.30760  74.32514
## [3,] 17.89085  33.52383  54.99438
## [4,] 64.22717 120.34873 197.42682
## [5,] 35.95471  67.37185 110.52057
## [6,] 48.95457  91.73097 150.48064</code></pre>
<p>Did you know that from this regression, each observation has their own survival curve? That is why we can get quantiles (we can go the “opposite” direction and get percentiles too!). Below you will find the survival curve for person 1…</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="survival-analysis-1.html#cb57-1" aria-hidden="true" tabindex="-1"></a>quant.prob<span class="ot">=</span><span class="fu">seq</span>(<span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="at">by=</span><span class="fl">0.05</span>)</span>
<span id="cb57-2"><a href="survival-analysis-1.html#cb57-2" aria-hidden="true" tabindex="-1"></a>survprob <span class="ot">=</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">se.fit =</span> <span class="cn">TRUE</span>,<span class="at">p =</span> quant.prob)</span>
<span id="cb57-3"><a href="survival-analysis-1.html#cb57-3" aria-hidden="true" tabindex="-1"></a>surv.prob<span class="ot">=</span><span class="fu">rev</span>(quant.prob)</span>
<span id="cb57-4"><a href="survival-analysis-1.html#cb57-4" aria-hidden="true" tabindex="-1"></a>graph.dat<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(survprob<span class="sc">$</span>fit[<span class="dv">1</span>,],surv.prob))</span>
<span id="cb57-5"><a href="survival-analysis-1.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(graph.dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;Tenure&quot;</span>,<span class="st">&quot;SurvivalProb&quot;</span>)</span>
<span id="cb57-6"><a href="survival-analysis-1.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(graph.dat,<span class="fu">aes</span>(<span class="at">x=</span>Tenure,<span class="at">y=</span>SurvivalProb))<span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Survival Curve for Person 1&quot;</span>,<span class="at">x=</span><span class="st">&quot;Tenure&quot;</span>,<span class="at">y=</span><span class="st">&quot;Survival Probability&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/Survival%20curve%20for%20person%201-1.png" width="672" />
We just predicted quantiles. We can go the opposite direction and find probabilities. To do this, the survreg function allows us to simply do psurvreg (we could have actually used qsurvreg for the previous piece in getting quantiles!!). Keep in mind that psurvreg is for the FAILURE probability (to get survival probabilities, we need to take 1-p, where p is the failure probability).</p>
<p>The below code finds the survival probability for each observed time! For example, person 1 was arrested on week 20 (where did that fall on their predicted survival curve?). Person 2 was arrested in week 17 (where did that fall on its predicted survival curve?).</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="survival-analysis-1.html#cb58-1" aria-hidden="true" tabindex="-1"></a>survprob.actual <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">psurvreg</span>(recid<span class="sc">$</span>week,</span>
<span id="cb58-2"><a href="survival-analysis-1.html#cb58-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>),</span>
<span id="cb58-3"><a href="survival-analysis-1.html#cb58-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale, <span class="at">distribution =</span>     recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb58-4"><a href="survival-analysis-1.html#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survprob.actual, <span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 0.9285822 0.8389085 0.6315234 0.8073231 0.6173609 0.7312118 0.9260438
##  [8] 0.7203354 0.5891529 0.7143008</code></pre>
<p>We can also do this for a given point in time (say 10 weeks)….</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="survival-analysis-1.html#cb60-1" aria-hidden="true" tabindex="-1"></a>survprob<span class="fl">.10</span>wk <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">psurvreg</span>(<span class="dv">10</span>,</span>
<span id="cb60-2"><a href="survival-analysis-1.html#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>),</span>
<span id="cb60-3"><a href="survival-analysis-1.html#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale,</span>
<span id="cb60-4"><a href="survival-analysis-1.html#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">distribution =</span> recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb60-5"><a href="survival-analysis-1.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(survprob<span class="fl">.10</span>wk)</span></code></pre></div>
<pre><code>## [1] 0.9723202 0.9198457 0.8803901 0.9789527 0.9531961 0.9693657</code></pre>
<p>To see the impact of the financial variable, we can look at those who did NOT have financial aid and what would they look like if they did have financial aid (impact of providing financial aid).</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="survival-analysis-1.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted Change in Event Time #</span></span>
<span id="cb62-2"><a href="survival-analysis-1.html#cb62-2" aria-hidden="true" tabindex="-1"></a>new_time <span class="ot">=</span> <span class="fu">qsurvreg</span>(<span class="dv">1</span> <span class="sc">-</span> survprob.actual,</span>
<span id="cb62-3"><a href="survival-analysis-1.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="fu">predict</span>(recid.aft.w, <span class="at">type =</span> <span class="st">&quot;lp&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-4"><a href="survival-analysis-1.html#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(recid.aft.w)[<span class="st">&#39;fin&#39;</span>],</span>
<span id="cb62-5"><a href="survival-analysis-1.html#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">scale =</span> recid.aft.w<span class="sc">$</span>scale,</span>
<span id="cb62-6"><a href="survival-analysis-1.html#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">distribution =</span> recid.aft.w<span class="sc">$</span>dist)</span>
<span id="cb62-7"><a href="survival-analysis-1.html#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="survival-analysis-1.html#cb62-8" aria-hidden="true" tabindex="-1"></a>recid<span class="sc">$</span>new_time <span class="ot">=</span> new_time</span>
<span id="cb62-9"><a href="survival-analysis-1.html#cb62-9" aria-hidden="true" tabindex="-1"></a>recid<span class="sc">$</span>diff <span class="ot">=</span> recid<span class="sc">$</span>new_time <span class="sc">-</span> recid<span class="sc">$</span>week</span>
<span id="cb62-10"><a href="survival-analysis-1.html#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="survival-analysis-1.html#cb62-11" aria-hidden="true" tabindex="-1"></a>impact.fin<span class="ot">=</span><span class="fu">data.frame</span>(recid<span class="sc">$</span>week, recid<span class="sc">$</span>new_time, recid<span class="sc">$</span>diff,recid<span class="sc">$</span>arrest,recid<span class="sc">$</span>fin)</span>
<span id="cb62-12"><a href="survival-analysis-1.html#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(impact.fin)<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;O.Week&quot;</span>,<span class="st">&quot;N.Week&quot;</span>,<span class="st">&quot;Diff&quot;</span>,<span class="st">&quot;Arrest&quot;</span>,<span class="st">&quot;Fin&quot;</span>)</span>
<span id="cb62-13"><a href="survival-analysis-1.html#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="survival-analysis-1.html#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="survival-analysis-1.html#cb62-15" aria-hidden="true" tabindex="-1"></a>impact.fin2<span class="ot">=</span><span class="fu">subset</span>(impact.fin,Arrest<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> Fin<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb62-16"><a href="survival-analysis-1.html#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(impact.fin2)</span></code></pre></div>
<pre><code>##    O.Week   N.Week      Diff Arrest Fin
## 1      20 25.66776  5.667764      1   0
## 2      17 21.81760  4.817600      1   0
## 3      25 32.08471  7.084706      1   0
## 7      23 29.51793  6.517929      1   0
## 13     37 47.48536 10.485364      1   0
## 15     25 32.08471  7.084706      1   0</code></pre>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cox-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/sjsimmo2/Survival/edit/master/02-tears.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/sjsimmo2/Survival/blob/master/02-tears.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
